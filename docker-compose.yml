version: "2.0"
services:
    rabbitmq:
        container_name: rabbitmq
        image: rabbitmq:3.11.13-management
        hostname: rabbitmq
        environment:
            TZ: UTC
            RABBITMQ_DEFAULT_USER: ${RABBITMQ_DEFAULT_USER}
            RABBITMQ_DEFAULT_PASS: ${RABBITMQ_DEFAULT_PASS}
            RABBITMQ_CONFIG_FILE: /etc/rabbitmq/rabbitmq.conf
        volumes:
            - rabbitedvol:/var/lib/rabbitmq
            - ${RABBITMQ_CONFIG_FILE}:/etc/rabbitmq/rabbitmq.conf
            - ${RABBITMQ_SSL_CACERTFILE}:/etc/rabbitmq/ca_certificate.pem
            - ${RABBITMQ_SSL_CERTFILE}:/etc/rabbitmq/server_certificate.pem
            - ${RABBITMQ_SSL_KEYFILE}:/etc/rabbitmq/server_key.pem
        ports:
            - "5672:5672"
            - "15672:15672"
        restart: always
    redis:
        container_name: redis
        image: redis:6.2.12
        environment:
            TZ: UTC
        volumes:
            - redisvol:/data
            - ${REDIS_CONDING_FILE}:/usr/local/etc/redis/redis.conf
        ports:
            - "6379:6379"
        restart: always
    postgis:
        container_name: postgis
        image: postgis/postgis:16-3.4
        environment:
            TZ: UTC
            POSTGRES_USER: ${POSTGRES_USER}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            POSTGRES_DB: ${POSTGRES_DB}
        volumes:
            - postgisvol:/var/lib/postgresql/data
        ports:
            - "5432:5432"
        restart: always
        command: postgres -c 'max_connections=5000' -c 'shared_buffers=250MB'

volumes:
    rabbitedvol:
    ed_database:
    redisvol:
    postgisvol: